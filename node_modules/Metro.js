Metro = new Object()

const xmlToJson = (xmlString, i_indent) => org.json.XMLKt.Companion.toJSONObject(xmlString, true).toString(i_indent ? i_indent : 4);
const jsonToXml = (jsonString) => org.json.XMLKt.Companion.toString(jsonString);

var cacheModule={} // require 관련 변수

function require(src,force){
    if(!force && cacheModule[src]!=undefined){
        return cacheModule[src];
    }
    else{
        var module = {exports:{}}
        var exports=module.exports
        eval(readFile("node_modules/"+src))
        cacheModule[src] = module.exports;
        return module.exports
    }
}

D = require("DBManager.js")
var myDB = android.database.sqlite.SQLiteDatabase.openDatabase("/sdcard/katalkbot/Bots/main/DB", null, android.database.sqlite.SQLiteDatabase.CREATE_IF_NECESSARY);

// ================= 방 관련 변수들 ====================
const console_room_name = "시립봇4 컨트롤방" // 콘솔방 이름



Metro.test = function test(station){

    /*
            "rowNum": "1",
                "selectedCount": "16",
                "totalCount": "16",
                "subwayId": "1001",
                "updnLine": "상행",
                "trainLineNm": "양주행 - 회기방면",
                "subwayHeading": "오른쪽",
                "statnFid": "1001000123",
                "statnTid": "1001000125",
                "statnId": "1001000124",
                "statnNm": "청량리",
                "ordkey": "01001양주0",
                "subwayList": "1001,1063,1067,1075",
                "statnList": "1001000124,1063075117",
                "barvlDt": "0",
                "btrainNo": "0168",
                "bstatnId": "248",
                "bstatnNm": "양주",
                "recptnDt": "2020-07-24 20:39:18.0",
                "arvlMsg2": "전역 도착",
                "arvlMsg3": "제기동",
                "arvlCd": "5"

     */

    let key = "556b6a434572316a35374c6b47524a"

    let body = JSON.parse(xmlToJson(org.jsoup.Jsoup.connect("http://swopenapi.seoul.go.kr/api/subway/"+key+"/xml/realtimeStationArrival/0/30/"+encodeURI(station)).get()))

    let temp = body.realtimeStationArrival.row

    let number = temp.map(v=>v.rowNum) // 출력 번호
    let totalCount = temp.map(v=>v.totalCount)[0] // 출력 번호
    let line_number = temp.map(v=>v.subwayId) // 지하철 노선명
    let updn = temp.map(v=>v.updnLine) // 상하행 구분
    let arrival_msg2 = temp.map(v=>v.arvlMsg2) // 도착정보 : ex> 2역전 혹은 얼마 후 도착인지
    let arrival_msg3 = temp.map(v=>v.arvlMsg3) // 현재위치
    let train_num = temp.map(v=>v.btrainNo) // 열차번호
    let last_station = temp.map(v=>v.bstatnNm) // 종착역

    let stationFid = temp.map(v=>v.statnFid) // 현재위치
    let stationTid = temp.map(v=>v.statnTid) // 열차번호
    let stationId = temp.map(v=>v.statnId) // 종착역

    let array = []

    for (let i=0 ; i<totalCount ; i++){
        array[i] = [[number[i]],[line_number[i]],[updn[i]],[train_num[i]],[arrival_msg2[i]],[arrival_msg3[i]],[last_station[i]],[stationFid[i]],[stationTid[i]],[stationId[i]]]
    }

    return array

}


Metro.parse = function parse(station){


    let station_name = station

    //Api.replyRoom(console_room_name, station.reduceMetro())
    let key = "556b6a434572316a35374c6b47524a"

    let body = JSON.parse(xmlToJson(org.jsoup.Jsoup.connect("http://swopenapi.seoul.go.kr/api/subway/"+key+"/xml/realtimeStationArrival/0/30/"+encodeURI(station_name)).get()))

    try{var temp = body.realtimeStationArrival.row}catch(e){var temp = ""}

    try{
        var number = temp.map(v=>v.rowNum) // 출력 번호
        var totalCount = temp.map(v=>v.totalCount)[0] // 출력 번호
        var line_number = temp.map(v=>v.subwayId) // 지하철 노선명
        var updn = temp.map(v=>v.updnLine) // 상하행 구분
        var arrival_msg2 = temp.map(v=>v.arvlMsg2) // 도착정보 : ex> 2역전 혹은 얼마 후 도착인지
        var arrival_msg3 = temp.map(v=>v.arvlMsg3) // 현재위치
        var train_num = temp.map(v=>v.btrainNo) // 열차번호
        var last_station = temp.map(v=>v.bstatnNm) // 종착역

        var stationFid = temp.map(v=>v.statnFid) // 현재위치
        var stationTid = temp.map(v=>v.statnTid) // 열차번호
        var stationId = temp.map(v=>v.statnId) // 종착역
    }
    catch(e){}


    let pre_array = []
    let array = []

    for (let i=0 ; i<totalCount ; i++){
        pre_array[i] = [[number[i]],[line_number[i]],[updn[i]],[train_num[i]],[arrival_msg2[i]],[arrival_msg3[i]]
            ,[last_station[i]],[stationFid[i]],[stationTid[i]],[stationId[i]],[arrival_msg2[i]]]
    }

    let unique_array = [pre_array[0]]
    for(let i=1 ; i<pre_array.length ; i++){
        if(unique_array.map(v=>String(v[3])).indexOf(String(pre_array[i][3])) < 0) unique_array.push(pre_array[i])
    }

    try{
        //array = array.concat( unique_array.filter(v=>String(v[4])==String(station_name+" 도착")) )
        array = array.concat( unique_array.filter(v=>String(v[4])==String(station_name+" 진입")) )
        array = array.concat( unique_array.filter(v=>String(v[4])==String("전역 출발")) )
        array = array.concat( unique_array.filter(v=>String(v[4])==String("전역 도착")) )
        array = array.concat( unique_array.filter(v=>String(v[4])==String("전역 진입")) )
    }
    catch(e){}

    // 가장 빨리오는 열차를 탐색 하기 위해 포맷을 맞춤
    for (let i=0 ; i<totalCount ; i++){
        try{
            let temp = Number( String(unique_array[i][4]).split("]번째")[0].split("[")[1] ) * 130 // 한정류장을 2분 30초로 환산
            if(isNaN(temp)==false){ unique_array[i][4] = temp }
        }catch(e){}
    }

    for (let i=0 ; i<totalCount ; i++){
        try{
            let temp = 0

            try{
                if(isNaN(unique_array[i][4])==false){
                    temp = unique_array[i][4]
                }
            } catch(e){temp = "UAM"}

            try{
                if(String(unique_array[i][4]).indexOf("분")!=-1){
                    temp = temp + Number( String(unique_array[i][4]).split("분")[0] ) * 60
                }
            } catch(e){temp = "UAM"}

            try{
                if(String(unique_array[i][4]).indexOf("초")!=-1){
                    temp = temp + Number( String(unique_array[i][4]).split("초")[0].split("분 ")[1] )}
            }catch(e){temp = "UAM"}

            if(isNaN(temp)==false){ unique_array[i][4] = temp }
            if(temp==0){ unique_array[i][4] = 50000 }

        }catch(e){}
    }

    try{
        unique_array = unique_array.filter(v=>isNaN(v[4])==false).filter(v=>Number(v[4])!=50000) //  도착 예정 시간이 숫자가 아닌 것들은 제거 (도착 진입 출발 등등의 것)

        array = array.concat( unique_array.sort(function(a,b){return Number(a[4])<Number(b[4]) ? -1 : Number(a[4]) > Number(b[4]) ? 1 : 0}) ) // 시간 오름차순 정렬
    }
    catch(e){}


    return array

}


Metro.output = function output(room,station){

    let station_name
    if(station.substr(station.length-1,1) == "역" && station){
        station_name = station.substr(0,station.length-1)
        station = station.substr(0,station.length-1)
    }
    else{
        station_name = station
    }
    station_name = station_name.reduceMetro()

    let data = Metro.parse(station_name)

    if(data.length>5){ data.splice(5,data.length-5) }

    let header_title = station+"역 검색 결과"
    let header_mobile_link = ""
    let header_web_link = ""
    let header_image = "http://27.115.156.176:7080/image/UOS_logo.png"
    let header_x = "800"
    let header_y = "136"
    let header = [header_title, header_mobile_link, header_web_link, header_image, header_x, header_y]

    let title = []
    let sub_title = []
    let link = []
    let mobile_link = []
    let THU = []
    for(let i=0 ; i<5 ; i++){
        try{
            title[i] = "현재 위치 : " + data[i][5] + "역 (" + data[i][6] + "행)"  // 현재 위치 : 선릉 (서울대입구행)
            sub_title[i] = String(data[i][10]).replace("[","").replace("]","")
            try{sub_title[i] = sub_title[i].split("(")[0]}catch(e){}
            THU[i] = String(data[i][1]).lineImage()
            link[i] = String(data[i][1]).lineLink()
        }
        catch(e){
            title[i] = "-"
            sub_title[i] = "-"
            THU[i] = ""
            link[i] = ""
        }
    }

    mobile_link = link

    let NEC = ["","",1] // 동물사진

    Metro.sendKaling_universal_5list(room,header,title,sub_title,link,mobile_link,THU,NEC)

}


String.prototype.reduceMetro = function(){ // 역명 Api 호환 형태로 변경


    if(this=="이수"||this=="총신대입구"){return "총신대입구(이수)"}
    else if(this=="올림픽공원"||this=="한국체대"){return "올림픽공원(한국체대)"}
    else if(this=="월드컵경기장"||this=="성산"){return "월드컵경기장(성산)"}
    else if(this=="대흥"||this=="서강대앞"){return "대흥(서강대앞)"}
    else if(this=="공릉"||this=="서울산업대입구"||this=="서울과기대입구"){return "공릉(서울산업대입구)"}
    else if(this=="숭실대입구"||this=="살피재"){return "숭실대입구(살피재)"}
    else if(this=="군자"||this=="능동"){return "군자(능동)"}
    else if(this=="천호"||this=="풍납토성"){return "천호(풍납토성)"}
    else if(this=="굽은다리"||this=="강동구민회관앞"){return "굽은다리(강동구민회관앞)"}
    else if(this=="남한산성입구"||this=="성남법원"){return "남한산성입구(성남법원, 검찰청)"}
    else if(this=="오목교"||this=="목동운동장앞"){return "오목교(목동운동장앞)"}
    else if(this=="몽촌토성"||this=="평화의문"){return "몽촌토성(평화의문)"}
    else if(this=="신촌(경의중앙선)"||this=="신촌경의중앙선"){return "신촌(경의.중앙선)"}
    else if(this=="증산"||this=="명지대앞"){return "증산(명지대앞)"}
    else if(this=="월곡"||this=="동덕여대"){return "월곡(동덕여대)"}
    else if(this=="어린이대공원"||this=="세종대"){return "어린이대공원(세종대)"}
    else if(this=="상도"||this=="중앙대앞"){return "상도(중앙대앞)"}
    else if(this=="신정"||this=="은행정"){return "신정(은행정)"}
    else if(this=="광나루"||this=="장신대"){return "광나루(장신대)"}
    else if(this=="새절"){return "새절(신사)"}
    else if(this=="상월곡"||this=="한국과학기술연구원"){return "상월곡(한국과학기술연구원)"}
    else if(this=="화랑대"||this=="서울여대입구"){return "화랑대(서울여대입구)"}
    else if(this=="응암순환"||this=="응암"||this=="상선"){return "응암순환(상선)"}
    else if(this=="쌍용"||this=="나사렛대"){return "쌍용(나사렛대)"}
    else if(this=="아차산"||this=="어린이대공원후문"){return "아차산(어린이대공원후문)"}
    else if(this=="안암"||this=="고대병원앞"){return "안암(고대병원앞)"}

    else{return this}
    /*

    if(this=="올림픽공원(한국체대)"){return "올림픽공원"}
    else if(this=="월드컵경기장(성산)"){return "월드컵경기장"}
    else if(this=="대흥(서강대앞)"){return "대흥"}
    else if(this=="공릉(서울산업대입구)"){return "공릉"}
    else if(this=="숭실대입구(살피재)"){return "숭실대입구"}
    else if(this=="군자(능동)"){return "군자"}
    else if(this=="천호(풍납토성)"){return "천호"}
    else if(this=="굽은다리(강동구민회관앞)"){return "굽은다리"}
    else if(this=="남한산성입구(성남법원, 검찰청)"){return "남한산성입구"}
    else if(this=="오목교(목동운동장앞)"){return "오목교"}
    else if(this=="몽촌토성(평화의문)"){return "몽촌토성"}
    else if(this=="증산(명지대앞)"){return "증산"}
    else if(this=="월곡(동덕여대)"){return "월곡"}
    else if(this=="어린이대공원(세종대)"){return "어린이대공원"}
    else if(this=="상도(중앙대앞)"){return "상도"}
    else if(this=="신정(은행정)"){return "신정"}
    else if(this=="광나루(장신대)"){return "광나루"}
    else if(this=="새절(신사)"){return "새절"}
    else if(this=="상월곡(한국과학기술연구원)"){return "상월곡"}
    else if(this=="화랑대(서울여대입구)"){return "화랑대"}
    else if(this=="응암순환(상선)"){return "응암순환"}
    else if(this=="총신대입구(이수)"){return "이수"}
    else if(this=="쌍용(나사렛대)"){return "쌍용"}
    else if(this=="아차산(어린이대공원후문)"){return "아차산"}
    else if(this=="안암(고대병원앞)"){return "안암"}
    else{return this}


     */
}


String.prototype.lineNumber = function(){ // 존나 긴 역명 줄여버리기

    if(this=="1001"){return "1호선"}
    else if(this=="1002"){return "2호선"}
    else if(this=="1003"){return "3호선"}
    else if(this=="1004"){return "4호선"}
    else if(this=="1005"){return "5호선"}
    else if(this=="1006"){return "6호선"}
    else if(this=="1007"){return "7호선"}
    else if(this=="1008"){return "8호선"}
    else if(this=="1009"){return "9호선"}
    else if(this=="1063"){return "경의중앙선"}
    else if(this=="1065"){return "공항철도"}
    else if(this=="1067"){return "경춘선"}
    else if(this=="1071"){return "수인선"}
    else if(this=="1075"){return "분당선"}
    else if(this=="1077"){return "신분당선"}
    else if(this=="1092"){return "우이신설선"}

    else{return this}
}


String.prototype.lineImage = function(){

    if(this=="1001"){return "http://27.115.156.176:7081/image/subway_mark_1001.png"}
    else if(this=="1002"){return "http://27.115.156.176:7081/image/subway_mark_1002.png"}
    else if(this=="1003"){return "http://27.115.156.176:7081/image/subway_mark_1003.png"}
    else if(this=="1004"){return "http://27.115.156.176:7081/image/subway_mark_1004.png"}
    else if(this=="1005"){return "http://27.115.156.176:7081/image/subway_mark_1005.png"}
    else if(this=="1006"){return "http://27.115.156.176:7081/image/subway_mark_1006.png"}
    else if(this=="1007"){return "http://27.115.156.176:7081/image/subway_mark_1007.png"}
    else if(this=="1008"){return "http://27.115.156.176:7081/image/subway_mark_1008.png"}
    else if(this=="1009"){return "http://27.115.156.176:7081/image/subway_mark_1009.png"}
    else if(this=="1063"){return "http://27.115.156.176:7081/image/subway_mark_1063.png"}
    else if(this=="1065"){return "http://27.115.156.176:7081/image/subway_mark_1065.png"}
    else if(this=="1067"){return "http://27.115.156.176:7081/image/subway_mark_1067.png"}
    else if(this=="1071"){return "http://27.115.156.176:7081/image/subway_mark_1071.png"}
    else if(this=="1075"){return "http://27.115.156.176:7081/image/subway_mark_1075.png"}
    else if(this=="1077"){return "http://27.115.156.176:7081/image/subway_mark_1077.png"}
    else if(this=="1092"){return "http://27.115.156.176:7081/image/subway_mark_1092.png"}

    else{return this}

}


String.prototype.lineLink = function(){

    if(this=="1001"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line1.png"}
    else if(this=="1002"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line2.png"}
    else if(this=="1003"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line3.png"}
    else if(this=="1004"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line4.png"}
    else if(this=="1005"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line5.png"}
    else if(this=="1006"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line6.png"}
    else if(this=="1007"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line7.png"}
    else if(this=="1008"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line8.png"}
    else if(this=="1009"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_line9.png"}
    else if(this=="1063"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_lineKY.png"}
    else if(this=="1065"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_lineAP.png"}
    else if(this=="1067"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_lineKC.png"}
    else if(this=="1071"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_lineSI.png"}
    else if(this=="1075"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_lineBD.png"}
    else if(this=="1077"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_lineSBD.png"}
    else if(this=="1092"){return "redirect_UOS?tourl=http://27.115.156.176:7081/image/subway_map_lineUI.png"}

    else{return this}

}


//====================================== 카링 ======================================



const kalingModule=require("KR.js").Kakao();

Metro.kakaoReset = function kakaoReset(){
    Kakao = new kalingModule();
    //Kakao.init("29fbf6ec828f27d72544c39a3bb4f8d0"); // P.kakaoint자리(이전)
    Kakao.init("904c559bc0ec53c94df6dad990b24c52"); //
    //Kakao.init("e02397085dc52168fe675d7013e1cfbf"); // P.kakaoint자리

    Kakao.login(Metro.getDB("kakaoId"), Metro.getDB("kakaoPw"));
}

// header 정보 : [제목, 모바일링크, 웹링크, 사진링크, x, y]
Metro.sendKaling_universal_5list = function sendKaling_universal_5list(room,header,title,sub_title,link,mobile_link,THU,NEC){

    let kalingObj = {
        "link_ver":"4.0",
        "template_id" : (33176),
        "template_args" : {
            header_title : String(header[0]),
            header_mobile_link : String(header[1]),
            header_web_link : String(header[2]),
            header_title_THU : String(header[3]),
            header_title_imaga_x : String(header[4]),
            header_title_imaga_y : String(header[5]),
            title1 : String(title[0]),
            title2 : String(title[1]),
            title3 : String(title[2]),
            title4 : String(title[3]),
            title5 : String(title[4]),
            sub_title1 : String(sub_title[0]),
            sub_title2 : String(sub_title[1]),
            sub_title3 : String(sub_title[2]),
            sub_title4 : String(sub_title[3]),
            sub_title5 : String(sub_title[4]),
            link1 : String(link[0]),
            link2 : String(link[1]),
            link3 : String(link[2]),
            link4 : String(link[3]),
            link5 : String(link[4]),
            mobile_link1 : String(mobile_link[0]),
            mobile_link2 : String(mobile_link[1]),
            mobile_link3 : String(mobile_link[2]),
            mobile_link4 : String(mobile_link[3]),
            mobile_link5 : String(mobile_link[4]),
            THU1 : String(THU[0]),
            THU2 : String(THU[1]),
            THU3 : String(THU[2]),
            THU4 : String(THU[3]),
            THU5 : String(THU[4]),
            link : String(NEC[0]),
            mobile_link : String(NEC[1]),
            listRank : NEC[2] // true false
        }
    }
    try{
        Kakao.send(room, kalingObj, "custom");
    }catch(e){
        UOSP.kakaoReset();
        Kakao.send(room, kalingObj, "custom");
    }

}


Metro.sendKaling_5list = function sendKaling_5list(room, header_title, title, sub_title, path, THU){


    let kalingObj = {
        "link_ver":"4.0",
        "template_id" : (33106),
        "template_args" : {
            header_title : String(header_title),
            title1 : String(title[0]),
            title2 : String(title[1]),
            title3 : String(title[2]),
            title4 : String(title[3]),
            title5 : String(title[4]),
            path1 : String(path[0]),
            path2 : String(path[1]),
            path3 : String(path[2]),
            path4 : String(path[3]),
            path5 : String(path[4]),
            sub_title1 : String(sub_title[0]),
            sub_title2 : String(sub_title[1]),
            sub_title3 : String(sub_title[2]),
            sub_title4 : String(sub_title[3]),
            sub_title5 : String(sub_title[4]),
            THU1 : String(THU[0]),
            THU2 : String(THU[1]),
            THU3 : String(THU[2]),
            THU4 : String(THU[3]),
            THU5 : String(THU[4])
        }
    }
    try{
        Kakao.send(room, kalingObj, "custom");
    }catch(e){
        UOSP.kakaoReset();
        Kakao.send(room, kalingObj, "custom");
    }
}

Metro.sendKaling_4list = function sendKaling_4list(room, header_title, title, sub_title, path, THU){


    let kalingObj = {
        "link_ver":"4.0",
        "template_id" : (33109),
        "template_args" : {
            header_title : String(header_title),
            title1 : String(title[0]),
            title2 : String(title[1]),
            title3 : String(title[2]),
            title4 : String(title[3]),
            path1 : String(path[0]),
            path2 : String(path[1]),
            path3 : String(path[2]),
            path4 : String(path[3]),
            sub_title1 : String(sub_title[0]),
            sub_title2 : String(sub_title[1]),
            sub_title3 : String(sub_title[2]),
            sub_title4 : String(sub_title[3]),
            THU1 : String(THU[0]),
            THU2 : String(THU[1]),
            THU3 : String(THU[2]),
            THU4 : String(THU[3])
        }
    }
    try{
        Kakao.send(room, kalingObj, "custom");
    }catch(e){
        UOSP.kakaoReset();
        Kakao.send(room, kalingObj, "custom");
    }
}

Metro.sendKaling_3list = function sendKaling_3list(room, header_title, title, sub_title, path, THU){


    let kalingObj = {
        "link_ver":"4.0",
        "template_id" : (33111),
        "template_args" : {
            header_title : String(header_title),
            title1 : String(title[0]),
            title2 : String(title[1]),
            title3 : String(title[2]),
            path1 : String(path[0]),
            path2 : String(path[1]),
            path3 : String(path[2]),
            sub_title1 : String(sub_title[0]),
            sub_title2 : String(sub_title[1]),
            sub_title3 : String(sub_title[2]),
            THU1 : String(THU[0]),
            THU2 : String(THU[1]),
            THU3 : String(THU[2])
        }
    }
    try{
        Kakao.send(room, kalingObj, "custom");
    }catch(e){
        UOSP.kakaoReset();
        Kakao.send(room, kalingObj, "custom");
    }
}

Metro.sendKaling_2list = function sendKaling_2list(room, header_title, title, sub_title, path, THU){


    let kalingObj = {
        "link_ver":"4.0",
        "template_id" : (33112),
        "template_args" : {
            header_title : String(header_title),
            title1 : String(title[0]),
            title2 : String(title[1]),
            path1 : String(path[0]),
            path2 : String(path[1]),
            sub_title1 : String(sub_title[0]),
            sub_title2 : String(sub_title[1]),
            THU1 : String(THU[0]),
            THU2 : String(THU[1])
        }
    }
    try{
        Kakao.send(room, kalingObj, "custom");
    }catch(e){
        UOSP.kakaoReset();
        Kakao.send(room, kalingObj, "custom");
    }
}

Metro.sendKaling_1list = function sendKaling_1list(room, header_title, title, sub_title, path, THU){

    let kalingObj = {
        "link_ver":"4.0",
        "template_id" : (33113),
        "template_args" : {
            header_title : String(header_title),
            title1 : String(title[0]),
            path1 : String(path[0]),
            sub_title1 : String(sub_title[0]),
            THU1 : String(THU[0])
        }
    }
    try{
        Kakao.send(room, kalingObj, "custom");
    }catch(e){
        UOSP.kakaoReset();
        Kakao.send(room, kalingObj, "custom");
    }
}

//========================================= 카링 끝 =========================================

// 테이블 생성 : myDB.execSQL("create table UOSPTable (k text PRIMARY KEY, v text);");

Metro.setDB = function setDB(key,value){
    if(D.selectForArray("UOSPTable", null, "k like ?", key).length == 0){ // 해당하는 key에 value가 없는 경우
        D.insert("UOSPTable",{k:key, v:value})
    }
    else{ // 해당하는 key에 value가 있는 경우
        D.update("UOSPTable", {v:value}, "k=?", [key])
    }
}


Metro.getDB = function getDB(key){
    var arr = D.selectForArray("UOSPTable", null, "k=?", [key]);
    if (arr.length > 0) {
        return arr[0][1];
    } else {
        return undefined;
    }
}


Metro.getNum = function getNum(key) {
    var value = UOSP.getDB(key);
    return isNaN(value) ? 0 : Number(UOSP.getDB(key));
}


module.exports = Metro
